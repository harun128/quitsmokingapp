{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _Box = _interopRequireDefault(require(\"../../components/UI/Box\"));\n\nvar _Text = _interopRequireDefault(require(\"../../components/UI/Text\"));\n\nvar _reactNative = require(\"react-native\");\n\nvar _socket = _interopRequireDefault(require(\"socket.io-client/dist/socket.io\"));\n\nvar _global = require(\"../../config/global\");\n\nvar _TextInput = _interopRequireDefault(require(\"../../components/UI/TextInput\"));\n\nvar _MessageItem = _interopRequireDefault(require(\"../../components/CustomLists/MessageItem\"));\n\nvar _reactNativeModals = _interopRequireWildcard(require(\"react-native-modals\"));\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _18n = _interopRequireDefault(require(\"./../../lang/_18n\"));\n\nvar _jsxFileName = \"C:\\\\Projeler\\\\quitsmoking\\\\src\\\\screens\\\\Community\\\\CommunityMessagesScreen.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nvar CommunityMessagesScreen = function (_React$Component) {\n  (0, _inherits2.default)(CommunityMessagesScreen, _React$Component);\n\n  var _super = _createSuper(CommunityMessagesScreen);\n\n  function CommunityMessagesScreen() {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, CommunityMessagesScreen);\n    _this = _super.call(this);\n    _this.connectionConfig = {\n      jsonp: false,\n      reconnection: true,\n      reconnectionDelay: 100,\n      reconnectionAttempts: 100000,\n      transports: ['websocket'],\n      upgrade: false,\n      agent: '-',\n      cert: '-',\n      ca: '-',\n      ciphers: '-',\n      rejectUnauthorized: '-',\n      perMessageDeflate: '-'\n    };\n    _this.socket = (0, _socket.default)(_global.socketUrl + \"community\", _this.connectionConfig);\n\n    _this._renderItem = function (_ref) {\n      var item = _ref.item,\n          index = _ref.index;\n      return _react.default.createElement(_MessageItem.default, {\n        giveAnswer: function giveAnswer() {\n          _this.setState({\n            message: _this.state.message + \" @\" + item.sender.username\n          });\n        },\n        onPress: function onPress() {\n          if (_this.props.userId !== item.sender._id) _this.props.navigation.navigate(\"UserProfile\", item.sender);\n        },\n        message: item == null ? void 0 : item.message,\n        sender: item == null ? void 0 : item.sender,\n        date: item == null ? void 0 : item.sendDate,\n        __self: (0, _assertThisInitialized2.default)(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 13\n        }\n      });\n    };\n\n    _this._sendMessage = function () {\n      var token = _this.props.token;\n\n      if (!token) {\n        _this.setState({\n          visible: true\n        });\n      }\n\n      var message = _this.state.message;\n\n      _this.socket.emit(\"sendMessage\", {\n        token: token,\n        message: message\n      });\n\n      _this.setState({\n        message: \"\"\n      });\n\n      _this.flatList.scrollToEnd({\n        animated: true\n      });\n    };\n\n    _this.state = {\n      messages: [],\n      message: '',\n      visible: false\n    };\n    _this.flatList = _react.default.createRef();\n\n    _this.socket.on(\"connect\", function () {});\n\n    _this.socket.on('connect_error', function (err) {});\n\n    return _this;\n  }\n\n  (0, _createClass2.default)(CommunityMessagesScreen, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this,\n          _s$props,\n          _s$props$country;\n\n      var s = this;\n      this.socket.on(\"lastMessages\", function (data) {\n        _this2.setState({\n          messages: data\n        });\n      });\n      s.socket.emit(\"joinRoom\", (_s$props = s.props) == null ? void 0 : (_s$props$country = _s$props.country) == null ? void 0 : _s$props$country.key);\n      this.props.navigation.addListener(\"focus\", function () {\n        setTimeout(function () {\n          var _s$props2, _s$props2$country;\n\n          s.socket.emit(\"joinRoom\", (_s$props2 = s.props) == null ? void 0 : (_s$props2$country = _s$props2.country) == null ? void 0 : _s$props2$country.key);\n        }, 1000);\n      });\n      this.socket.on(\"newMessage\", function (data) {\n        var newArray = [].concat((0, _toConsumableArray2.default)(_this2.state.messages), [data]);\n\n        _this2.setState({\n          messages: newArray\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return _react.default.createElement(_reactNative.SafeAreaView, {\n        style: {\n          flex: 1\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }\n      }, _react.default.createElement(_Box.default, {\n        style: {\n          flex: 1\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 16\n        }\n      }, _react.default.createElement(_reactNative.FlatList, {\n        ref: function ref(_ref2) {\n          return _this3.flatList = _ref2;\n        },\n        onContentSizeChange: function onContentSizeChange() {\n          return _this3.flatList.scrollToEnd({\n            animated: true\n          });\n        },\n        onLayout: function onLayout() {\n          return _this3.flatList.scrollToEnd({\n            animated: true\n          });\n        },\n        data: this.state.messages,\n        renderItem: this._renderItem,\n        keyExtractor: function keyExtractor(item) {\n          return item._id;\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 24\n        }\n      }), _react.default.createElement(_Box.default, {\n        flexDirection: \"row\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        borderTopWidth: 1,\n        borderTopColor: \"#bdc3c7\",\n        p: 1,\n        bg: \"#ecf0f1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 20\n        }\n      }, _react.default.createElement(_TextInput.default, {\n        value: this.state.message,\n        onChangeText: function onChangeText(val) {\n          return _this3.setState({\n            message: val\n          });\n        },\n        style: styles.input,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 24\n        }\n      }), _react.default.createElement(_reactNative.TouchableOpacity, {\n        activeOpacity: 0.7,\n        style: styles.sendButton,\n        onPress: function onPress() {\n          return _this3._sendMessage();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 24\n        }\n      }, _react.default.createElement(_Text.default, {\n        color: \"white\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 29\n        }\n      }, _18n.default.t(\"community.send\"))))), _react.default.createElement(_Box.default, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 17\n        }\n      }, _react.default.createElement(_reactNativeModals.default, {\n        visible: this.state.visible,\n        modalTitle: _react.default.createElement(_Box.default, {\n          bg: \"#FAB045\",\n          height: 50,\n          justifyContent: \"center\",\n          alignItems: \"center\",\n          title: \"Giri\\u015F Yap\",\n          color: \"red\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 37\n          }\n        }, _react.default.createElement(_Text.default, {\n          fontSize: 18,\n          color: \"white\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 150\n          }\n        }, _18n.default.t(\"community.sign_in\"))),\n        footer: _react.default.createElement(_reactNativeModals.ModalFooter, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 29\n          }\n        }, _react.default.createElement(_reactNativeModals.ModalButton, {\n          text: _18n.default.t(\"community.close\"),\n          onPress: function onPress() {\n            _this3.setState({\n              visible: false\n            });\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 33\n          }\n        }), _react.default.createElement(_reactNativeModals.ModalButton, {\n          text: _18n.default.t(\"community.sign_in\"),\n          onPress: function onPress() {\n            _this3.setState({\n              visible: false\n            });\n\n            _this3.props.navigation.navigate(\"Profilim\");\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 33\n          }\n        })),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 21\n        }\n      }, _react.default.createElement(_reactNativeModals.ModalContent, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 25\n        }\n      }, _react.default.createElement(_Text.default, {\n        py: 3,\n        px: 2,\n        fontSize: 18,\n        textAlign: \"center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 29\n        }\n      }, _18n.default.t(\"community.errors.send_message\"))))));\n    }\n  }]);\n  return CommunityMessagesScreen;\n}(_react.default.Component);\n\nvar styles = _reactNative.StyleSheet.create({\n  input: {\n    borderWidth: 1,\n    borderColor: '#ddd',\n    backgroundColor: '#fff',\n    flex: 1,\n    height: 38,\n    paddingHorizontal: 5\n  },\n  sendButton: {\n    backgroundColor: \"#2980b9\",\n    height: 37,\n    justifyContent: 'center',\n    alignItems: 'center',\n    paddingHorizontal: 8,\n    borderTopRightRadius: 5,\n    borderBottomRightRadius: 5\n  }\n});\n\nvar mapStateToProps = function mapStateToProps(state) {\n  var us = state.us;\n  return {\n    token: us.token,\n    location: us.location,\n    description: us.profileDescription,\n    country: us.country,\n    userId: us.userId\n  };\n};\n\nvar _default = (0, _reactRedux.connect)(mapStateToProps)(CommunityMessagesScreen);\n\nexports.default = _default;","map":{"version":3,"sources":["C:/Projeler/quitsmoking/src/screens/Community/CommunityMessagesScreen.js"],"names":["CommunityMessagesScreen","connectionConfig","jsonp","reconnection","reconnectionDelay","reconnectionAttempts","transports","upgrade","agent","cert","ca","ciphers","rejectUnauthorized","perMessageDeflate","socket","socketUrl","_renderItem","item","index","setState","message","state","sender","username","props","userId","_id","navigation","navigate","sendDate","_sendMessage","token","visible","emit","flatList","scrollToEnd","animated","messages","React","createRef","on","err","s","data","country","key","addListener","setTimeout","newArray","flex","ref","val","styles","input","sendButton","I18n","t","Component","StyleSheet","create","borderWidth","borderColor","backgroundColor","height","paddingHorizontal","justifyContent","alignItems","borderTopRightRadius","borderBottomRightRadius","mapStateToProps","us","location","description","profileDescription"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport Box from \"../../components/UI/Box\";\r\nimport Text from \"../../components/UI/Text\";\r\nimport {SafeAreaView,ScrollView,StyleSheet,TouchableOpacity ,FlatList,Animated} from \"react-native\";\r\nimport io from 'socket.io-client/dist/socket.io';\r\nimport {socketUrl} from \"../../config/global\";\r\nimport TextInput from \"../../components/UI/TextInput\";\r\nimport MessageItem from \"../../components/CustomLists/MessageItem\";\r\nimport Modal, {  ModalContent,ModalFooter,ModalButton } from 'react-native-modals';\r\nimport {connect} from 'react-redux';\r\nimport I18n from \"./../../lang/_18n\"\r\nclass CommunityMessagesScreen extends React.Component{\r\n     connectionConfig = {\r\n        jsonp: false,\r\n        reconnection: true,\r\n        reconnectionDelay: 100,\r\n        reconnectionAttempts: 100000,\r\n         transports: [ 'websocket' ],\r\n         upgrade: false,\r\n         agent: '-',\r\n         cert: '-',\r\n         ca: '-',\r\n         ciphers: '-',\r\n         rejectUnauthorized: '-',\r\n         perMessageDeflate: '-',\r\n\r\n    };\r\n\r\n    socket = io(socketUrl+\"community\",this.connectionConfig);\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.state = {\r\n            messages : [],\r\n            message : '',\r\n            visible : false\r\n        }\r\n        this.flatList = React.createRef();\r\n        this.socket.on(\"connect\",() => {\r\n\r\n        });\r\n        this.socket.on('connect_error', function(err){\r\n\r\n        });\r\n    }\r\n    componentDidMount(): void {\r\n\r\n        const s = this;\r\n\r\n        this.socket.on(\"lastMessages\",(data) =>{\r\n            this.setState({messages:data});\r\n        });\r\n        s.socket.emit(\"joinRoom\",(s.props?.country?.key));\r\n        this.props.navigation.addListener(\"focus\",() =>{\r\n            setTimeout(()=>{\r\n                s.socket.emit(\"joinRoom\",(s.props?.country?.key));\r\n            },1000);\r\n        })\r\n\r\n        this.socket.on(\"newMessage\",(data) => {\r\n            let newArray = [...this.state.messages,data];\r\n            this.setState({messages:newArray});\r\n        })\r\n    }\r\n\r\n    _renderItem =({item,index})=> {\r\n        return (\r\n            <MessageItem\r\n                giveAnswer={() => {this.setState({message:this.state.message + \" @\"+item.sender.username})}}\r\n                onPress={() => {\r\n                    if(this.props.userId !== item.sender._id)\r\n                        this.props.navigation.navigate(\"UserProfile\",item.sender)}\r\n                }\r\n                message={item?.message}\r\n                sender={item?.sender}\r\n                date={item?.sendDate}\r\n            />\r\n        )\r\n    }\r\n\r\n    _sendMessage = () => {\r\n        let {token} = this.props\r\n        if(!token) {\r\n            this.setState({visible:true});\r\n        }\r\n        let {message} = this.state;\r\n        this.socket.emit(\"sendMessage\",{token:token,message:message});\r\n        this.setState({message:\"\"});\r\n        this.flatList.scrollToEnd({animated:true});\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <SafeAreaView style={{flex:1}}>\r\n               <Box style={{flex: 1}} >\r\n                       <FlatList\r\n                           ref={ref => (this.flatList = ref)}\r\n                           onContentSizeChange={() => this.flatList.scrollToEnd({animated: true})}\r\n                           onLayout={() => this.flatList.scrollToEnd({animated: true})}\r\n                           data={this.state.messages}\r\n                           renderItem={this._renderItem}\r\n                           keyExtractor={item => item._id}\r\n                       />\r\n                   <Box flexDirection={\"row\"} alignItems={\"center\"} justifyContent={\"center\"} borderTopWidth={1} borderTopColor={\"#bdc3c7\"} p={1} bg={\"#ecf0f1\"}>\r\n                       <TextInput value={this.state.message} onChangeText={(val) => this.setState({message:val})} style={styles.input}/>\r\n                       <TouchableOpacity activeOpacity={0.7} style={styles.sendButton} onPress={() => this._sendMessage()}>\r\n                            <Text color={\"white\"}>{I18n.t(\"community.send\")}</Text>\r\n                       </TouchableOpacity>\r\n                   </Box>\r\n               </Box>\r\n                <Box>\r\n                    <Modal\r\n                        visible={this.state.visible}\r\n                        modalTitle={<Box bg={\"#FAB045\"}  height={50} justifyContent={\"center\"} alignItems={\"center\"} title=\"GiriÅŸ Yap\" color={\"red\"}><Text fontSize={18} color={\"white\"}>{I18n.t(\"community.sign_in\")}</Text></Box>}\r\n                        footer={\r\n                            <ModalFooter>\r\n                                <ModalButton\r\n                                    text={I18n.t(\"community.close\")}\r\n                                    onPress={() => {this.setState({visible:false})}}\r\n                                />\r\n                                <ModalButton\r\n                                    text={I18n.t(\"community.sign_in\")}\r\n                                    onPress={() => {\r\n                                        this.setState({visible:false});\r\n                                        this.props.navigation.navigate(\"Profilim\");\r\n                                    }}\r\n                                />\r\n                            </ModalFooter>\r\n                        }\r\n                    >\r\n                        <ModalContent>\r\n                            <Text py={3} px={2} fontSize={18} textAlign={\"center\"}>{I18n.t(\"community.errors.send_message\")}</Text>\r\n                        </ModalContent>\r\n                    </Modal>\r\n                </Box>\r\n            </SafeAreaView>\r\n        )\r\n    }\r\n}\r\n\r\nconst styles= StyleSheet.create({\r\n    input : {\r\n        borderWidth:1,\r\n        borderColor:'#ddd',\r\n        backgroundColor:'#fff',\r\n        flex:1,\r\n        height:38,\r\n        paddingHorizontal:5,\r\n    },\r\n\r\n    sendButton: {\r\n        backgroundColor:\"#2980b9\",\r\n        height:37,\r\n        justifyContent: 'center',\r\n        alignItems:'center',\r\n        paddingHorizontal: 8,\r\n        borderTopRightRadius: 5,\r\n        borderBottomRightRadius: 5\r\n    }\r\n\r\n})\r\n\r\nconst mapStateToProps =(state) => {\r\n    const {us} = state;\r\n    return {\r\n        token:us.token,\r\n        location:us.location,\r\n        description:us.profileDescription,\r\n        country:us.country,\r\n        userId:us.userId\r\n    }\r\n}\r\n\r\nexport default  connect(mapStateToProps)(CommunityMessagesScreen);\r\n"]},"metadata":{},"sourceType":"script"}